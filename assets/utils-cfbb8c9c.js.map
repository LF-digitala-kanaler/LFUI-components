{"version":3,"file":"utils-cfbb8c9c.js","sources":["../../src/js/utils.js"],"sourcesContent":["// @ts-check\n\nconst EVENT_PREFIX = /^on/\n\nexport const refs = new WeakMap()\n\n/**\n * Generate unique(-ish) identifier\n * @returns {string}\n */\nexport function uid() {\n  return `u${Math.random().toString(36).substring(2)}`\n}\n\n/**\n * Render html template\n * @param {string[]} strings Tagged template string parts\n * @param  {...any} values Tagged template partial values\n * @returns {DocumentFragment}\n */\nexport function html(strings, ...values) {\n  if (!Array.isArray(strings)) strings = [strings]\n\n  const div = document.createElement('div')\n  const frag = document.createDocumentFragment()\n\n  div.innerHTML = strings.reduce(function (acc, string, index) {\n    acc += string\n    const value = values[index]\n    if (value) {\n      if (value instanceof window.DocumentFragment) {\n        const temp = document.createElement('div')\n        temp.append(...Array.from(value.childNodes))\n        acc += temp.innerHTML\n      } else {\n        acc += value\n      }\n    }\n    return acc\n  }, '')\n\n  frag.append(...Array.from(div.childNodes))\n\n  return frag\n}\n\n/**\n * Iterate through each matching node\n * @param {string} selector Node selector\n * @param {function(Element, number, NodeList): void} callback Iterator callback\n * @param {Element|Document} [context] Node context to search in\n */\nexport function each(selector, callback, context = document) {\n  context.querySelectorAll(selector).forEach(callback)\n}\n\n/**\n * Delegate event listener to children matching selector\n * @param {string} selector Node selector\n * @param {function(Event): void} handler Event handler\n * @returns {function(Event): void}\n */\nexport function delegate(selector, handler) {\n  return function (event) {\n    const target = /** @type {Element} */ (event.target)\n    const _target = target.matches(selector) ? target : target.closest(selector)\n    if (_target) handler.call(_target, event)\n  }\n}\n\n/**\n * Create a node reference\n */\nexport class Ref {\n  /**\n   * Currently referenced node\n   * @type {Node}\n   */\n  get current() {\n    return refs.get(this)\n  }\n}\n\n/**\n * Render node\n * @param {string} type Node type\n * @param {object} attrs Node attributes\n * @param {(string | Node)[]} children Node children\n * @returns {Node}\n */\nexport function h(type, attrs = {}, children = []) {\n  const el = document.createElement(type)\n\n  for (const [key, value] of Object.entries(attrs)) {\n    if (key === 'ref') {\n      if (typeof value === 'function') value(el)\n      else refs.set(value, el)\n    } else if (EVENT_PREFIX.test(key)) {\n      el.addEventListener(key.replace(EVENT_PREFIX, ''), value)\n    } else if (key in el) {\n      el[key] = value\n    } else {\n      el.setAttribute(key, value)\n    }\n  }\n\n  if (!Array.isArray(children)) children = [children]\n  if (children.length) {\n    el.append(\n      ...children.filter(Boolean).map(function (child) {\n        return child instanceof window.Node ? child : document.createTextNode(child)\n      })\n    )\n  }\n\n  return el\n}\n"],"names":["EVENT_PREFIX","refs","WeakMap","uid","Math","random","toString","substring","html","strings","values","Array","isArray","div","document","createElement","frag","createDocumentFragment","innerHTML","reduce","acc","string","index","value","window","DocumentFragment","temp","append","from","childNodes","each","selector","callback","context","querySelectorAll","forEach","delegate","handler","event","target","_target","matches","closest","call","Ref","current","get","h","type","attrs","children","el","key","Object","entries","set","test","addEventListener","replace","setAttribute","length","filter","Boolean","map","child","Node","createTextNode"],"mappings":"AAEA,MAAMA,EAAe,MAERC,EAAO,IAAIC,QAMjB,SAASC,GAAM,CACpB,MAAQ,IAAGC,KAAKC,SAASC,SAAS,EAAE,EAAEC,UAAU,CAAC,GACnD,CAQO,SAASC,EAAKC,KAAYC,EAAQ,CAClCC,MAAMC,QAAQH,CAAO,IAAGA,EAAU,CAACA,CAAO,GAE/C,MAAMI,EAAMC,SAASC,cAAc,KAAK,EAClCC,EAAOF,SAASG,yBAEtBJ,OAAAA,EAAIK,UAAYT,EAAQU,OAAO,SAAUC,EAAKC,EAAQC,EAAO,CAC3DF,GAAOC,EACP,MAAME,EAAQb,EAAOY,CAAK,EAC1B,GAAIC,EACF,GAAIA,aAAiBC,OAAOC,iBAAkB,CAC5C,MAAMC,EAAOZ,SAASC,cAAc,KAAK,EACzCW,EAAKC,OAAO,GAAGhB,MAAMiB,KAAKL,EAAMM,UAAU,CAAC,EAC3CT,GAAOM,EAAKR,eAEZE,GAAOG,EAGX,OAAOH,CACR,EAAE,EAAE,EAELJ,EAAKW,OAAO,GAAGhB,MAAMiB,KAAKf,EAAIgB,UAAU,CAAC,EAElCb,CACT,CAQO,SAASc,EAAKC,EAAUC,EAAUC,EAAUnB,SAAU,CAC3DmB,EAAQC,iBAAiBH,CAAQ,EAAEI,QAAQH,CAAQ,CACrD,CAQO,SAASI,EAASL,EAAUM,EAAS,CAC1C,OAAO,SAAUC,EAAO,CACtB,MAAMC,EAAiCD,EAAMC,OACvCC,EAAUD,EAAOE,QAAQV,CAAQ,EAAIQ,EAASA,EAAOG,QAAQX,CAAQ,EACvES,GAASH,EAAQM,KAAKH,EAASF,CAAK,EAE5C,CAKO,MAAMM,CAAI,CAKf,IAAIC,SAAU,CACZ,OAAO5C,EAAK6C,IAAI,IAAI,CACtB,CACF,CASO,SAASC,EAAEC,EAAMC,EAAQ,CAAA,EAAIC,EAAW,CAAA,EAAI,CACjD,MAAMC,EAAKrC,SAASC,cAAciC,CAAI,EAEtC,SAAW,CAACI,EAAK7B,CAAK,IAAK8B,OAAOC,QAAQL,CAAK,EACzCG,IAAQ,MACN,OAAO7B,GAAU,WAAYA,EAAM4B,CAAE,EACpClD,EAAKsD,IAAIhC,EAAO4B,CAAE,EACdnD,EAAawD,KAAKJ,CAAG,EAC9BD,EAAGM,iBAAiBL,EAAIM,QAAQ1D,EAAc,EAAE,EAAGuB,CAAK,EAC/C6B,KAAOD,EAChBA,EAAGC,CAAG,EAAI7B,EAEV4B,EAAGQ,aAAaP,EAAK7B,CAAK,EAI9B,OAAKZ,MAAMC,QAAQsC,CAAQ,IAAGA,EAAW,CAACA,CAAQ,GAC9CA,EAASU,QACXT,EAAGxB,OACD,GAAGuB,EAASW,OAAOC,OAAO,EAAEC,IAAI,SAAUC,EAAO,CAC/C,OAAOA,aAAiBxC,OAAOyC,KAAOD,EAAQlD,SAASoD,eAAeF,CAAK,CAC5E,CAAA,CACH,EAGKb,CACT"}